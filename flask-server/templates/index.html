{% extends 'base.html' %}

{% block title %} Home {% endblock %}

{% block styles %}
    {{ super() }} <!-- keep base css -->
{% endblock %}

{% block body %}

<section class="hero-section" id="hero">
    <div class="welcome">
        <img src="../static/images/frogart_small.gif" alt="frogart_small">
        <h1>Welcome to<br><span>Dooby!</span></h1>
    </div>
    <div class="header">
        <div class="dropdown-profile">
            <img src="../static/images/profile.png" class="profileBtn">
            <div class="profile-container">
                <button class="btn close-profile-btn">X</button>
                <div class="dropdown-profile-content">
                    <h2>Hello, {{ name }}</h2>
                    <p>{{ email }}</p>
                    <a href="{{ url_for('profile') }}">Edit Profile</a>
                    <a href="{{ url_for('collaboration') }}" class="collab-link">Collaborations</a>
                    <a href="{{ url_for('logout') }}" class="logout-btn">Log Out</a>
                </div>
            </div>
        </div>
    </div>
    <div class="task-body">
        <div class="task-header">
            <div class="dropdown">
                <button class="btn sort-btn">Sort By <i class="fa fa-caret-down"></i></button>
                <div class="dropdown-content">
                    <a href="{{ url_for('index', list_id=current_list_id, sort='priority') }}">Priority (Highest)</a>
                    <a href="{{ url_for('index', list_id=current_list_id, sort='created_at', order='desc') }}">Date of Creation</a>
                    <a href="{{ url_for('index', list_id=current_list_id, sort='deadline', order='asc') }}">Deadline</a>
                </div>
            </div>
        </div>
        <div class="tasks-container" id="tasks-container">
            <ul class="tasks-list">
                {% if tasks|length == 0 %}
                    <p>You don't have any tasks yet :)</p><br>
                    <p>Click Add Task to Start!</p>
                {% else %}
                    {% for task in tasks %} 
                        <li class="{{task[3]}}">
                            <div class="task-item">
                                <div class="task-box-list">
                                    <input type="checkbox" class="checkbox" data-taskid="{{task[0]}}" onchange="toggleTask(this.dataset.taskid, this.checked)" {% if task[2] == 1 %} checked {% endif %}>
                                    <p> {{task[1]}}</p><br>
                                </div>
                                <span>Priority: {{task[3]}}<br>Deadline: {{task[4]}}<br>Created at: {{task[5]}}</span>
                            </div>
                            <!-- edit and delete task -->
                            <div class="update-btns">
                                <button class="btn edit-btn" data-taskid="{{task[0]}}" data-taskname="{{task[1]}}" data-priority="{{task[3]}}" data-deadline="{{task[4]}}">Edit</button>
                                <button class="btn delete-btn" data-taskid="{{task[0]}}">Delete</button>
                            </div>
                        </li><br>
                        <hr class="horizontal"><br>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
        <div class="popup confirm-delete-popup" id="confirm-delete-popup">
            <div class="confirm-delete-content">
                <p>Are you sure you want to delete this task?</p>
                <button class="btn confirm-delete-btn">Yes</button>
                <button class="btn cancel-delete-btn">Cancel</button>
            </div>
        </div>
        <div class="task-add-body">
            <button id="open-task-btn" class="btn open-btn">Add Task</button>
        </div>
        <div class="popup add-task-popup" id="add-task-popup">
            <div class="add-task-content">
                <button class="btn close-btn" id="close-add-btn">X</button>
                <h2>Add a new task:</h2>
                <form action="/add_task" method="POST">
                    <label for="task_name">Task name:</label><br>
                    <input type="text" id="task_name" name="task_name" placeholder="Enter task..." required><br>

                    <label for="priority">Priority Level:</label><br>
                    <select name="priority" id="priority" required>
                        <option value="high" id="high-priority">High</option>
                        <option value="medium" id="medium-priority">Medium</option>
                        <option value="low">Low</option>
                    </select><br>

                    <label for="deadline">Deadline:</label><br>
                    <input type="datetime-local" id="deadline" name="deadline" value="2025-09-10T14:30" required><br>
                    
                    <input type="hidden" name="list_id" value="{{ current_list_id }}">
                    <input type="submit" class="btn submit-btn" value="Submit">
                </form>
            </div>
        </div>
        <div class="popup edit-task-popup" id="edit-task-popup">
            <div class="edit-task-content">
                <button class="btn close-btn" id="close-edit-btn">X</button>
                <h2>Edit task:</h2>
                <form id="edit-task-form" method="POST">
                    <label for="task-name">Task name:</label><br>
                    <input type="text" id="edit-task" name="task_name" required><br>

                    <label for="priority">Priority Level:</label><br>
                    <select name="priority" id="edit-priority" required>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select><br>

                    <label for="deadline">Deadline:</label><br>
                    <input type="datetime-local" id="edit-deadline" name="deadline"><br>

                    <input type="hidden" name="list_id" value="{{ current_list_id }}">
                    <input type="submit" class="btn submit-btn" value="Save">
                </form>
            </div>
        </div>
    </div>
</section>

{% endblock %}